
package service;

import entity.HanhKhach;
import java.io.*;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;

public class HanhKhachManager{
    private final List<HanhKhach> hklist;
    private final String filePath = "khachhang.txt";
    //Ra vào file khachhang.txt
    public HanhKhachManager(){
        hklist = new ArrayList<>();
        loadHanhKhachFromFile();
    }


    private void loadHanhKhachFromFile(){
        try(BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(filePath), StandardCharsets.UTF_8))){
            String line;
            while((line = br.readLine()) != null){
                String[] parts = line.split(",");
                if(parts.length == 6){
                    int maKhachHang = Integer.parseInt(parts[0]);
                    String tenKhachHang = parts[1];
                    String soDienThoai = parts[2];
                    String diaChi = parts[3];
                    int maChuyenBay = Integer.parseInt(parts[4]);
                    int maVe = Integer.parseInt(parts[5]);
                    hklist.add(new HanhKhach(maKhachHang, tenKhachHang, soDienThoai, diaChi, maChuyenBay, maVe));
                }
            }
        } catch(IOException e){
            System.out.println("Lỗi: " + e.getMessage());
        }
    }

    private void saveHanhKhachToFile(){
        try(BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(filePath, false), StandardCharsets.UTF_8))){
            for(HanhKhach hanhKhach : hklist){
                bw.write(hanhKhach.getMaKhachHang() + "," +
                         hanhKhach.getTenKhachHang() + "," +
                         hanhKhach.getSoDienThoai() + "," +
                         hanhKhach.getDiaChi() + "," +
                         hanhKhach.getMaChuyenBay() + "," +
                         hanhKhach.getMaVe());
                bw.newLine();
            }
        } catch(IOException e){
            System.out.println("Không thể lưu file khách hàng: " + e.getMessage());
        }
    }


    public void addHanhKhach(HanhKhach hanhKhach){
        hklist.add(hanhKhach);
        saveHanhKhachToFile();
        System.out.println("Thêm khách hàng thành công!");
    }


    public void showHanhKhach(){
        if(hklist.isEmpty()){
            System.out.println("Không có khách hàng nào.");
            return;
        }
        System.out.println("\n=== Danh sách khách hàng ===");
        for(HanhKhach hanhKhach : hklist){
            System.out.println("Mã khách hàng: " + hanhKhach.getMaKhachHang() +
                    ", Tên khách hàng: " + hanhKhach.getTenKhachHang() +
                    ", SĐT: " + hanhKhach.getSoDienThoai() +
                    ", Địa chỉ: " + hanhKhach.getDiaChi() +
                    ", Mã chuyến bay: " + hanhKhach.getMaChuyenBay() +
                    ", Mã vé: " + hanhKhach.getMaVe());
        }
    }


    public void editHanhKhach(int maKhachHang){
        for(HanhKhach hanhKhach : hklist){
            if(hanhKhach.getMaKhachHang() == maKhachHang){

                try(Scanner sc = new Scanner(System.in, StandardCharsets.UTF_8)){
                    System.out.print("Nhập tên khách hàng mới: ");
                    String tenKhachHang = sc.nextLine();
                    hanhKhach.setTenKhachHang(tenKhachHang);
                    saveHanhKhachToFile();
                    System.out.println("Chỉnh sửa khách hàng thành công!");
                }
            }
        }
        System.out.println("Không tìm thấy khách hàng với mã đã nhập.");
    }


    public void deleteHanhKhach(int maKhachHang){
        HanhKhach toDelete = null;
        for(HanhKhach hanhKhach : hklist){
            if(hanhKhach.getMaKhachHang() == maKhachHang){
                toDelete = hanhKhach;
                break;
            }
        }
        if(toDelete != null){
            hklist.remove(toDelete);
            saveHanhKhachToFile();
            System.out.println("Xóa khách hàng thành công!");
        } else{
            System.out.println("Không tìm thấy khách hàng với mã đã nhập.");
        }
    }
}
